<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Shares Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #ecf0f1;
            --accent-color: #3498db;
            --bg-color: #1e272e;
            --card-bg: #2f3640;
            --input-bg: #353b48;
            --text-color: #dcdde1;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--card-bg);
            padding: 10px 30px 20px 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1, h2 {
            text-align: center;
            color: var(--primary-color);
            margin: 5px 0 15px 0;
        }

        .initial-shares {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 15px;
            padding: 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: var(--border-radius);
            font-size: 0.9em;
        }

        .initial-shares b {
            color: var(--accent-color);
        }

        .grid-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #485460;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.82em;
            margin-bottom: 3px;
            color: #95a5a6;
            font-weight: 600;
            white-space: nowrap;
        }

        input {
            padding: 8px;
            border: 1px solid #485460;
            border-radius: 4px;
            font-size: 0.95em;
            background-color: var(--input-bg);
            color: white;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        .section-label {
            grid-column: 1 / -1;
            font-size: 0.85em;
            color: var(--accent-color);
            font-weight: bold;
            margin-top: 10px;
            border-bottom: 1px solid #485460;
            padding-bottom: 5px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background-color: #353b48;
            padding: 10px;
            border-radius: var(--border-radius);
            text-align: center;
            border-left: 4px solid var(--accent-color);
        }

        .card h3 {
            margin: 0 0 5px 0;
            font-size: 0.8em;
            color: #95a5a6;
            text-transform: uppercase;
        }

        .card .value {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Sale Scenario Styles */
        .slider-section {
            background: #222f3e;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid #485460;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #ecf0f1;
            font-weight: bold;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--accent-color);
            box-sizing: border-box; /* Fix for sticking out */
            margin: 0;
            padding: 0;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .scenario-box {
            background: #2f3640;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #576574;
        }

        .scenario-box small {
            display: block;
            color: #95a5a6;
            font-size: 0.75em;
            margin-bottom: 4px;
        }

        .scenario-box strong {
            color: #2ecc71;
            font-size: 1.05em;
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            margin-bottom: 30px;
            background: #2f3640;
            padding: 10px;
            border-radius: var(--border-radius);
        }

        .equity-section {
            background-color: #1e272e;
            padding: 20px;
            border-radius: var(--border-radius);
        }

        .equity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
        }

        .equity-box {
            background: #2f3640;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .equity-box h3 {
            color: var(--accent-color);
            margin-top: 0;
        }

        .percentage {
            font-size: 2em;
            font-weight: bold;
            color: #ecf0f1;
            display: block;
            margin: 10px 0;
        }

        .equity-details {
            font-size: 0.9em;
            color: #95a5a6;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Floating Shares Calculator</h1>

    <div class="initial-shares">
        <span>Initial Davide: <b id="initDavidePct">0%</b></span>
        <span>Initial Giada: <b id="initGiadaPct">0%</b></span>
    </div>

    <!-- Inputs -->
    <div class="grid-inputs">
        <div class="section-label">Mortgage Details</div>
        <div class="input-group">
            <label for="mortgageAmount">Mortgage Amount (£)</label>
            <input type="text" id="mortgageAmount" value="325,000">
        </div>
        <div class="input-group">
            <label for="interestRate">Interest Rate (%)</label>
            <input type="number" id="interestRate" value="3.88" step="0.01">
        </div>
        <div class="input-group">
            <label for="termYears">Term (Years)</label>
            <input type="number" id="termYears" value="35">
        </div>
        <div class="input-group">
            <label for="monthlyPayment">Monthly Payment (£)</label>
            <input type="text" id="monthlyPayment" value="1,415.80">
        </div>

        <div class="section-label">Deposits & Property</div>
        <div class="input-group">
            <label for="depositDavide">Davide Deposit (£)</label>
            <input type="text" id="depositDavide" value="116,000">
        </div>
        <div class="input-group">
            <label for="depositGiada">Giada Deposit (£)</label>
            <input type="text" id="depositGiada" value="62,500">
        </div>
        <div class="input-group">
            <label>Appreciation Rate (%)</label>
            <input type="number" id="appreciationRate" value="2.0" step="0.1">
        </div>

        <div class="section-label">Overpayments</div>
        <div class="input-group">
            <label for="overpayDavide">Davide Monthly (£)</label>
            <input type="text" id="overpayDavide" value="0">
        </div>
        <div class="input-group">
            <label for="overpayGiada">Giada Monthly (£)</label>
            <input type="text" id="overpayGiada" value="0">
        </div>
        
        <div class="input-group">
            <label>Davide Lump Sum (£)</label>
            <input type="text" id="lumpDavide" value="0">
        </div>
        <div class="input-group">
            <label>Giada Lump Sum (£)</label>
            <input type="text" id="lumpGiada" value="0">
        </div>
    </div>

    <!-- Real-time Data Summary -->
    <div class="summary-cards">
        <div class="card">
            <h3>Total Paid</h3>
            <div class="value" id="valTotalPaid">£0</div>
        </div>
        <div class="card">
            <h3>Total Interest</h3>
            <div class="value" id="valTotalInterest">£0</div>
        </div>
        <div class="card">
            <h3>Total Principal</h3>
            <div class="value" id="valTotalPrincipal">£0</div>
        </div>
        <div class="card">
            <h3>Time Saved</h3>
            <div class="value" id="valTimeSaved" style="color: #2ecc71;">0y 0m</div>
        </div>
    </div>

    <!-- Sale Scenario Slider -->
    <div class="slider-section">
        <div class="slider-header">
            <span>Sale Scenario Analysis</span>
            <span id="sliderDisplay" style="color: var(--accent-color); font-size: 1.1em;">Year 35</span>
        </div>
        <input type="range" id="saleYearSlider" min="1" max="35" value="35" step="1">
        
        <div class="scenario-grid">
            <div class="scenario-box">
                <small>Est. Property Value</small>
                <strong id="scenValue">£0</strong>
            </div>
            <div class="scenario-box">
                <small>Remaining Debt</small>
                <strong id="scenDebt" style="color: #e74c3c;">£0</strong>
            </div>
            <div class="scenario-box">
                <small>Davide Cash Out</small>
                <strong id="scenDavide">£0</strong>
            </div>
            <div class="scenario-box">
                <small>Giada Cash Out</small>
                <strong id="scenGiada">£0</strong>
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="chart-container">
        <canvas id="mortgageChart"></canvas>
    </div>

    <!-- Floating Shares -->
    <div class="equity-section">
        <h2 id="sharesTitle">Final Floating Shares</h2>
        <div class="equity-grid">
            <div class="equity-box">
                <h3>Davide</h3>
                <span class="percentage" id="davidePercent">0%</span>
                <div class="equity-details">Initial: £<span id="davideInitial"></span></div>
            </div>
            <div class="equity-box">
                <h3>Giada</h3>
                <span class="percentage" id="giadaPercent">0%</span>
                <div class="equity-details">Initial: £<span id="giadaInitial"></span></div>
            </div>
        </div>
        <p style="text-align: center; margin-top: 15px; font-size: 0.85em; color: #777;">
            Formula: (Initial Deposit + 50% of Cumulative Principal Paid + 100% of Own Overpayments) / Total Equity
        </p>
    </div>
</div>

<script>
    // Elements
    const inputs = {
        amount: document.getElementById('mortgageAmount'),
        rate: document.getElementById('interestRate'),
        term: document.getElementById('termYears'),
        payment: document.getElementById('monthlyPayment'),
        depDavide: document.getElementById('depositDavide'),
        depGiada: document.getElementById('depositGiada'),
        appreciation: document.getElementById('appreciationRate'),
        
        overDavide: document.getElementById('overpayDavide'),
        overGiada: document.getElementById('overpayGiada'),
        
        lumpDavide: document.getElementById('lumpDavide'),
        lumpGiada: document.getElementById('lumpGiada')
    };

    const display = {
        totalPaid: document.getElementById('valTotalPaid'),
        interest: document.getElementById('valTotalInterest'),
        principal: document.getElementById('valTotalPrincipal'),
        timeSaved: document.getElementById('valTimeSaved'),
        dPercent: document.getElementById('davidePercent'),
        gPercent: document.getElementById('giadaPercent'),
        dInitial: document.getElementById('davideInitial'),
        gInitial: document.getElementById('giadaInitial'),
        initD: document.getElementById('initDavidePct'),
        initG: document.getElementById('initGiadaPct'),

        // Scenario
        sharesTitle: document.getElementById('sharesTitle'),
        slider: document.getElementById('saleYearSlider'),
        sliderDisplay: document.getElementById('sliderDisplay'),
        scenValue: document.getElementById('scenValue'),
        scenDebt: document.getElementById('scenDebt'),
        scenDavide: document.getElementById('scenDavide'),
        scenGiada: document.getElementById('scenGiada')
    };

    let chart;
    let yearlyDataStore = []; // Store calculated data for the slider

    // Helper: Format Currency
    const fmtMoney = (num) => {
        return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(num);
    };

    // Helper: Parse Number from formatted string
    const parseNum = (str) => {
        if (!str) return 0;
        // Remove commas and spaces
        const clean = str.toString().replace(/[, ]/g, '');
        const val = parseFloat(clean);
        return isNaN(val) ? 0 : val;
    };

    // Helper: Format Input Value with Commas
    const formatInput = (input) => {
        const val = parseNum(input.value);
        if (input.id === 'monthlyPayment') {
             input.value = val.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        } else {
             input.value = val.toLocaleString('en-GB');
        }
    };

    // Calculation Logic
    function calculateMortgage() {
        // Parse Inputs
        const P = parseNum(inputs.amount.value);
        const r_annual = parseFloat(inputs.rate.value);
        const r = (r_annual / 100) / 12;
        const years = parseFloat(inputs.term.value);
        const n = years * 12;
        
        let M = parseNum(inputs.payment.value);
        
        const depD = parseNum(inputs.depDavide.value);
        const depG = parseNum(inputs.depGiada.value);
        const appRate = parseFloat(inputs.appreciation.value) / 100;

        const overD = parseNum(inputs.overDavide.value);
        const overG = parseNum(inputs.overGiada.value);
        
        const lumpD = parseNum(inputs.lumpDavide.value);
        const lumpG = parseNum(inputs.lumpGiada.value);

        // -- SMART SPREAD CALCULATION --
        let estimatedMonths = n;
        let spreadD = 0;
        let spreadG = 0;

        for (let i = 0; i < 10; i++) {
            spreadD = estimatedMonths > 0 ? lumpD / estimatedMonths : 0;
            spreadG = estimatedMonths > 0 ? lumpG / estimatedMonths : 0;

            let simBalance = P;
            let simMonth = 0;
            for (let m = 1; m <= n; m++) {
                const interest = simBalance * r;
                let principal = M - interest;
                if (simBalance < principal) principal = simBalance;
                simBalance -= principal;

                let od = overD + spreadD; 
                if (simBalance < od) od = simBalance;
                simBalance -= od;

                let og = overG + spreadG; 
                if (simBalance < og) og = simBalance;
                simBalance -= og;

                simMonth = m;
                if (simBalance <= 0.01) break;
            }
            if (Math.abs(simMonth - estimatedMonths) <= 1) {
                estimatedMonths = simMonth;
                break; 
            }
            estimatedMonths = simMonth;
        }
        spreadD = estimatedMonths > 0 ? lumpD / estimatedMonths : 0;
        spreadG = estimatedMonths > 0 ? lumpG / estimatedMonths : 0;

        // -- AMORTIZATION LOOP --
        let balance = P;
        let totalInterest = 0;
        let totalPrincipalStandard = 0;
        let totalOverpayD = 0;
        let totalOverpayG = 0;

        // Data for Chart
        const labels = [];
        const dataBalance = [];
        const dataInterest = [];
        const dataDavidePct = [];
        const dataGiadaPct = [];
        
        yearlyDataStore = []; // Reset storage

        // Initial State (Year 0)
        labels.push(0);
        dataBalance.push(balance); 
        dataInterest.push(0);
        
        const initialEquity = depD + depG;
        const initDPct = initialEquity > 0 ? (depD / initialEquity) * 100 : 0;
        const initGPct = initialEquity > 0 ? (depG / initialEquity) * 100 : 0;

        display.initD.innerText = initDPct.toFixed(2) + '%';
        display.initG.innerText = initGPct.toFixed(2) + '%';
        
        dataDavidePct.push(initDPct);
        dataGiadaPct.push(initGPct);

        // Store Year 0 Data
        yearlyDataStore.push({
            year: 0,
            balance: balance,
            dPct: initDPct,
            gPct: initGPct
        });

        // Simulation
        let monthsPaid = 0;
        let isPaidOff = false;
        
        // Purchase Price for Appreciation
        const purchasePrice = P + depD + depG;

        for (let month = 1; month <= n; month++) {
            if (isPaidOff && month > n) break; // Stop loop if done, but we need to fill yearly data if we want flat lines? No, we stop.

            let principalPaymentStandard = 0;
            let interestPayment = 0;

            if (!isPaidOff) {
                // 1. Standard Payment
                interestPayment = balance * r;
                principalPaymentStandard = M - interestPayment;
                if (balance < principalPaymentStandard) principalPaymentStandard = balance;
                
                balance -= principalPaymentStandard;
                if (balance < 0.01) balance = 0;

                totalInterest += interestPayment;
                totalPrincipalStandard += principalPaymentStandard;

                // 2. Overpayments (Monthly + Spread)
                let od = overD + spreadD;
                if (balance < od) od = balance;
                balance -= od;
                totalOverpayD += od;

                let og = overG + spreadG;
                if (balance < og) og = balance;
                balance -= og;
                totalOverpayG += og;
                
                monthsPaid = month;
                if (balance <= 0.01) {
                    balance = 0;
                    isPaidOff = true;
                }
            }

            // Record Yearly Data (or if payoff month)
            if (month % 12 === 0 || (isPaidOff && month === monthsPaid)) {
                const currentYear = parseFloat((month / 12).toFixed(2));
                const lastLabel = labels[labels.length - 1];

                // Avoid duplicates
                if (currentYear !== lastLabel) {
                    labels.push(currentYear);
                    dataBalance.push(balance);
                    dataInterest.push(totalInterest);

                    // Equity Calc
                    const equityD = depD + (0.5 * totalPrincipalStandard) + totalOverpayD;
                    const equityG = depG + (0.5 * totalPrincipalStandard) + totalOverpayG;
                    const totalEq = equityD + equityG;

                    const dPct = totalEq > 0 ? (equityD / totalEq) * 100 : 0;
                    const gPct = totalEq > 0 ? (equityG / totalEq) * 100 : 0;

                    dataDavidePct.push(dPct);
                    dataGiadaPct.push(gPct);

                    // Store for Slider
                    yearlyDataStore.push({
                        year: Math.ceil(currentYear), // Use integer year for slider matching
                        balance: balance,
                        dPct: dPct,
                        gPct: gPct
                    });
                }
            }
            
            if (isPaidOff && month === monthsPaid) break;
        }

        // -- UPDATE DISPLAY --
        const totalPrincipalPaid = totalPrincipalStandard + totalOverpayD + totalOverpayG;
        const totalPaidOverall = depD + depG + totalPrincipalPaid + totalInterest;

        // Time Saved
        const totalMonthsSaved = n - monthsPaid;
        const yearsSaved = Math.floor(totalMonthsSaved / 12);
        const monthsSavedRemainder = totalMonthsSaved % 12;
        display.timeSaved.innerText = `${yearsSaved}y ${monthsSavedRemainder}m`;

        display.totalPaid.innerText = fmtMoney(totalPaidOverall);
        display.interest.innerText = fmtMoney(totalInterest);
        display.principal.innerText = fmtMoney(totalPrincipalPaid);
        display.dInitial.innerText = depD.toLocaleString();
        display.gInitial.innerText = depG.toLocaleString();

        // -- CHART UPDATE --
        updateChart(labels, dataBalance, dataInterest, dataDavidePct, dataGiadaPct);
        
        // -- UPDATE SCENARIO SLIDER --
        // Update slider max to term (or 35 if not paid off)
        display.slider.max = Math.ceil(monthsPaid / 12);
        updateScenario(); // Refresh scenario with current slider val
    }

    // Scenario Logic
    function updateScenario() {
        const year = parseInt(display.slider.value);
        display.sliderDisplay.innerText = `Year ${year}`;

        // Find data for this year (or closest)
        // yearlyDataStore has integer years.
        let data = yearlyDataStore.find(d => d.year === year);
        
        // If exact year not found (e.g. paid off at 15.5), use last available
        if (!data) {
             data = yearlyDataStore[yearlyDataStore.length - 1];
        }

        if (data) {
            const P = parseNum(inputs.amount.value);
            const depD = parseNum(inputs.depDavide.value);
            const depG = parseNum(inputs.depGiada.value);
            const appRate = parseFloat(inputs.appreciation.value) / 100;
            const purchasePrice = P + depD + depG;

            // Future Value = P * (1+r)^n
            const futureValue = purchasePrice * Math.pow(1 + appRate, year);
            const remainingDebt = data.balance;
            const netEquity = futureValue - remainingDebt;

            // Cash Out based on Shares
            const cashD = netEquity * (data.dPct / 100);
            const cashG = netEquity * (data.gPct / 100);

            display.scenValue.innerText = fmtMoney(futureValue);
            display.scenDebt.innerText = fmtMoney(remainingDebt);
            display.scenDavide.innerText = fmtMoney(cashD);
            display.scenGiada.innerText = fmtMoney(cashG);

            // Update Final Floating Shares section to match slider year
            display.sharesTitle.innerText = `Floating Shares (Year ${year})`;
            display.dPercent.innerText = data.dPct.toFixed(2) + '%';
            display.gPercent.innerText = data.gPct.toFixed(2) + '%';
        }
    }
    
    // Slider Event
    display.slider.addEventListener('input', updateScenario);


    // Chart.js Logic
    function updateChart(labels, dataBalance, dataInterest, dataDavidePct, dataGiadaPct) {
        const ctx = document.getElementById('mortgageChart').getContext('2d');

        if (chart) {
            chart.data.labels = labels;
            chart.data.datasets[0].data = dataBalance;
            chart.data.datasets[1].data = dataInterest;
            chart.data.datasets[2].data = dataDavidePct;
            chart.data.datasets[3].data = dataGiadaPct;
            chart.update();
            return;
        }

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Remaining Balance',
                        data: dataBalance,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.3,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Cumulative Interest',
                        data: dataInterest,
                        borderColor: '#f1c40f',
                        backgroundColor: 'rgba(241, 196, 15, 0.1)',
                        fill: true,
                        tension: 0.3,
                        yAxisID: 'y'
                    },
                    {
                        label: "Davide %",
                        data: dataDavidePct,
                        borderColor: '#2ecc71',
                        borderDash: [5, 5],
                        backgroundColor: 'transparent',
                        fill: false,
                        tension: 0.3,
                        yAxisID: 'y1'
                    },
                    {
                        label: "Giada %",
                        data: dataGiadaPct,
                        borderColor: '#9b59b6',
                        borderDash: [5, 5],
                        backgroundColor: 'transparent',
                        fill: false,
                        tension: 0.3,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Years', color: '#95a5a6' },
                        grid: { color: '#485460' },
                        ticks: { color: '#95a5a6' }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true,
                        grid: { color: '#485460' },
                        ticks: { color: '#95a5a6', callback: (v) => '£' + v.toLocaleString('en-GB') }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Ownership %', color: '#95a5a6' },
                        ticks: { color: '#95a5a6', callback: (v) => v + '%' }
                    }
                },
                plugins: {
                    legend: { labels: { color: '#dcdde1' } },
                    tooltip: {
                        backgroundColor: '#2f3640',
                        titleColor: '#ecf0f1',
                        bodyColor: '#dcdde1',
                        borderColor: '#485460',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) {
                                    if (context.dataset.yAxisID === 'y1') {
                                        label += context.parsed.y.toFixed(2) + '%';
                                    } else {
                                        label += new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP', maximumFractionDigits:0 }).format(context.parsed.y);
                                    }
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Auto-update Monthly Payment
    function updateMonthlyPayment() {
        const P = parseNum(inputs.amount.value);
        const r_annual = parseFloat(inputs.rate.value);
        const r = (r_annual / 100) / 12;
        const years = parseFloat(inputs.term.value);
        const n = years * 12;

        if (P && r && n) {
            const numerator = P * r * Math.pow(1 + r, n);
            const denominator = Math.pow(1 + r, n) - 1;
            const M = numerator / denominator;
            inputs.payment.value = M.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        calculateMortgage();
    }

    // Listeners
    // Format on blur
    Object.values(inputs).forEach(input => {
        if(input.type === 'text') {
            input.addEventListener('blur', () => formatInput(input));
        }
    });

    inputs.amount.addEventListener('input', updateMonthlyPayment);
    inputs.rate.addEventListener('input', updateMonthlyPayment);
    inputs.term.addEventListener('input', updateMonthlyPayment);
    
    Object.values(inputs).forEach(input => {
        if(input !== inputs.amount && input !== inputs.rate && input !== inputs.term) {
             input.addEventListener('input', calculateMortgage);
        }
    });

    // Initial Run
    calculateMortgage();

</script>

</body>
</html>